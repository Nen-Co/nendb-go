# ğŸ³ Fiber + NenDB Recipe Makefile
# Easy commands for building, testing, and running the recipe

.PHONY: help build test run clean deps install

# Default target
help:
	@echo "ğŸ³ Fiber + NenDB Recipe - Available Commands:"
	@echo ""
	@echo "ğŸ“¦ Setup:"
	@echo "  deps      - Download dependencies"
	@echo "  install   - Install dependencies"
	@echo ""
	@echo "ğŸ”¨ Build:"
	@echo "  build     - Build the recipe"
	@echo "  clean     - Clean build artifacts"
	@echo ""
	@echo "ğŸ§ª Test:"
	@echo "  test      - Run tests"
	@echo "  test-v    - Run tests with verbose output"
	@echo ""
	@echo "ğŸš€ Run:"
	@echo "  run       - Run the recipe"
	@echo "  dev       - Run with live reload (requires air)"
	@echo ""
	@echo "ğŸ“š Documentation:"
	@echo "  readme    - Show recipe README"
	@echo "  help      - Show this help message"

# Download dependencies
deps:
	@echo "ğŸ“¦ Downloading dependencies..."
	go mod download
	@echo "âœ… Dependencies downloaded"

# Install dependencies
install:
	@echo "ğŸ“¦ Installing dependencies..."
	go mod tidy
	go mod download
	@echo "âœ… Dependencies installed"

# Build the recipe
build:
	@echo "ğŸ”¨ Building Fiber + NenDB recipe..."
	go build -o fiber-nendb-recipe .
	@echo "âœ… Recipe built successfully"

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -f fiber-nendb-recipe
	@echo "âœ… Cleaned successfully"

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	go test ./...
	@echo "âœ… Tests completed"

# Run tests with verbose output
test-v:
	@echo "ğŸ§ª Running tests with verbose output..."
	go test -v ./...
	@echo "âœ… Tests completed"

# Run the recipe
run:
	@echo "ğŸš€ Starting Fiber + NenDB recipe..."
	@echo "ğŸ“– Make sure NenDB server is running on localhost:8080"
	@echo "ğŸŒ Recipe will be available at http://localhost:3000"
	@echo ""
	go run main.go

# Run with live reload (requires air)
dev:
	@echo "ğŸš€ Starting Fiber + NenDB recipe with live reload..."
	@echo "ğŸ“– Make sure NenDB server is running on localhost:8080"
	@echo "ğŸŒ Recipe will be available at http://localhost:3000"
	@echo ""
	@if command -v air > /dev/null; then \
		air; \
	else \
		echo "âŒ Air not found. Install with: go install github.com/cosmtrek/air@latest"; \
		echo "ğŸ’¡ Or run without live reload: make run"; \
	fi

# Show recipe README
readme:
	@echo "ğŸ“š Fiber + NenDB Recipe README:"
	@echo "=================================="
	@cat README.md

# Quick start - setup everything and run
quickstart: deps build test run

# Development workflow
dev-setup: deps install test
	@echo "ğŸ¯ Development environment ready!"
	@echo "ğŸ’¡ Run 'make run' to start the recipe"
	@echo "ğŸ’¡ Run 'make dev' for live reload (requires air)"
